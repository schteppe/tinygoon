(function() { "use strict"; function f() {
goo.Joint=function(t){function e(e){this._name=e,this._index=0,this._parentIndex=0,this._inverseBindPose=new t}return e.NO_PARENT=-32768,e}(goo.Transform),goo.Skeleton=function(t){function e(t,e){this._name=t,this._joints=e}return e.prototype.clone=function(){for(var n=this._name,o=this._joints,i=[],a=0,r=o.length;r>a;a++){var s=o[a],l=s._name,c=new t(l);c._index=s._index,c._parentIndex=s._parentIndex,c._inverseBindPose.copy(s._inverseBindPose),c._inverseBindPose.update(),i[a]=c}return new e(n,i)},e}(goo.Joint),goo.SkeletonPose=function(t,e,n){function o(e){this._skeleton=e,this._localTransforms=[],this._globalTransforms=[],this._matrixPalette=[],this._poseListeners=[];for(var o=this._skeleton._joints.length,i=0;o>i;i++)this._localTransforms[i]=new t;for(var i=0;o>i;i++)this._globalTransforms[i]=new t;for(var i=0;o>i;i++)this._matrixPalette[i]=new n;this.setToBindPose()}return o.prototype.setToBindPose=function(){for(var t=0;t<this._localTransforms.length;t++){this._localTransforms[t].matrix.copy(this._skeleton._joints[t]._inverseBindPose.matrix).invert();var o=this._skeleton._joints[t]._parentIndex;o!==e.NO_PARENT&&n.combine(this._skeleton._joints[o]._inverseBindPose.matrix,this._localTransforms[t].matrix,this._localTransforms[t].matrix)}this.updateTransforms()},o.prototype.updateTransforms=function(){for(var t=this._skeleton._joints,o=0,i=t.length;i>o;o++){var a=t[o]._parentIndex;a!==e.NO_PARENT?n.combine(this._globalTransforms[a].matrix,this._localTransforms[o].matrix,this._globalTransforms[o].matrix):this._globalTransforms[o].matrix.copy(this._localTransforms[o].matrix),n.combine(this._globalTransforms[o].matrix,t[o]._inverseBindPose.matrix,this._matrixPalette[o])}this.firePoseUpdated()},o.prototype.firePoseUpdated=function(){for(var t=this._poseListeners.length-1;t>=0;t--)this._poseListeners[t].poseUpdated(this)},o.prototype.clone=function(){return new o(this._skeleton)},o}(goo.Transform,goo.Joint,goo.Matrix4x4),goo.TransformData=function(t,e){function n(n){this._rotation=(new t).copy(n?n._rotation:t.IDENTITY),this._scale=(new e).copy(n?n._scale:e.ONE),this._translation=(new e).copy(n?n._translation:e.ZERO)}return n.prototype.applyTo=function(t){t.rotation.copyQuaternion(this._rotation),t.scale.setVector(this._scale),t.translation.setVector(this._translation),t.update()},n.prototype.set=function(t){this._rotation.copy(t._rotation),this._scale.copy(t._scale),this._translation.copy(t._translation)},n.prototype.blend=function(e,o,i){var a=i?i:new n;return a._translation.setVector(this._translation).lerp(e._translation,o),a._scale.setVector(this._scale).lerp(e._scale,o),t.slerp(this._rotation,e._rotation,o,a._rotation),a},n}(goo.Quaternion,goo.Vector3),goo.BinaryLERPSource=function(t,e){function n(t,e,n){this._sourceA=t?t:null,this._sourceB=e?e:null,this.blendWeight=n?n:null}return n.prototype.getSourceData=function(){var t=this._sourceA?this._sourceA.getSourceData():null,e=this._sourceB?this._sourceB.getSourceData():null;return n.combineSourceData(t,e,this.blendWeight)},n.prototype.setTime=function(t){var e=!1,n=!1;return this._sourceA&&(e=this._sourceA.setTime(t)),this._sourceB&&(n=this._sourceB.setTime(t)),e||n},n.prototype.resetClips=function(t){this._sourceA&&this._sourceA.resetClips(t),this._sourceB&&this._sourceB.resetClips(t)},n.prototype.shiftClipTime=function(t){this._sourceA&&this._sourceA.shiftClipTime(t),this._sourceB&&this._sourceB.shiftClipTime(t)},n.prototype.setTimeScale=function(t){this._sourceA.setTimeScale(t),this._sourceB.setTimeScale(t)},n.prototype.isActive=function(){var t=!1;return this._sourceA&&(t=t||this._sourceA.isActive()),this._sourceB&&(t=t||this._sourceB.isActive()),t},n.combineSourceData=function(t,o,i,a){if(!o)return t;if(!t)return o;var r=a?a:{};for(var s in t){var l=t[s],c=o[s];isNaN(l)?l instanceof e?c?r[s]=l.blend(c,i,r[s]):r[s]?r[s].set(l):r[s]=new l.constructor(l):r[s]=l:n.blendFloatValues(r,s,i,l,c)}for(var s in o)r[s]||(r[s]=o[s]);return r},n.blendFloatValues=function(e,n,o,i,a){e[n]=isNaN(a)?i:t.lerp(o,i[0],a[0])},n.prototype.clone=function(){return new n(this._sourceA,this._sourceB,this._blendWeight)},n}(goo.MathUtils,goo.TransformData),goo.AnimationClipInstance=function(t){function e(){this._active=!0,this._loopCount=0,this._timeScale=1,this._startTime=0,this._prevClockTime=0,this._prevUnscaledClockTime=0,this._clipStateObjects={}}return e.prototype.setTimeScale=function(e,n){if(n="undefined"!=typeof n?n:t.time,this._active&&this._timeScale!==e)if(0!==this._timeScale&&0!==e){var o=n,i=o-this._startTime;i*=this._timeScale,i/=e,this._startTime=o-i}else if(0===this._timeScale){var o=n;this._startTime=o-this._prevUnscaledClockTime}this._timeScale=e},e.prototype.getApplyTo=function(t){var e=t._channelName,n=this._clipStateObjects[e];return n||(n=t.createStateDataObject(),this._clipStateObjects[e]=n),n},e.prototype.clone=function(){var t=new e;return t._active=this._active,t._loopCount=this._loopCount,t._timeScale=this._timeScale,t},e}(goo.World),goo.ClipSource=function(t,e){function n(t,n,o){this._clip=t,this._clipInstance=new e,this._filterChannels={},this._filter=null,this.setFilter(n,o),this._startTime=-1/0,this._endTime=1/0}return n.prototype.setFilter=function(t,e){if(t&&e){this._filter=["Exclude","Include"].indexOf(t)>-1?t:null;for(var n=0;n<e.length;n++)this._filterChannels[e[n]]=!0}else this._filter=null},n.prototype.setTime=function(e){var n=this._clipInstance;"number"!=typeof n._startTime&&(n._startTime=e);var o,i;if(n._active){0!==n._timeScale?(n._prevUnscaledClockTime=e-n._startTime,o=n._timeScale*n._prevUnscaledClockTime,n._prevClockTime=o):o=n._prevClockTime;var a=Math.min(this._clip._maxTime,this._endTime),r=Math.max(this._startTime,0);if(i=a-r,-1===a)return!1;0!==a&&(-1===n._loopCount?0>o?(o*=-1,o%=i,o=i-o,o+=r):(o%=i,o+=r):n._loopCount>0&&i*n._loopCount>=Math.abs(o)&&(0>o?(o*=-1,o%=i,o=i-o,o+=r):(o%=i,o+=r)),(o>a||r>o)&&(o=t.clamp(o,r,a),n._active=!1)),this._clip.update(o,n)}return n._active},n.prototype.resetClips=function(t){this._clipInstance._startTime="undefined"!=typeof t?t:0,this._clipInstance._active=!0},n.prototype.shiftClipTime=function(t){this._clipInstance._startTime+=t,this._clipInstance._active=!0},n.prototype.setTimeScale=function(t){this._clipInstance.setTimeScale(t)},n.prototype.isActive=function(){return this._clipInstance._active&&-1!==this._clip._maxTime},n.prototype.getSourceData=function(){if(!this._filter||!this._filterChannels)return this._clipInstance._clipStateObjects;var t=this._clipInstance._clipStateObjects,e={},n="Include"===this._filter;for(var o in t)void 0!==this._filterChannels[o]===n&&(e[o]=t[o]);return e},n.prototype.clone=function(){var t=new n(this._clip);t._clipInstance=this._clipInstance.clone(),t._filter=this._filter;for(var e in this._filterChannels)t._filterChannels[e]=this._filterChannels[e];return t._startTime=this._startTime,t._endTime=this._endTime,t},n}(goo.MathUtils,goo.AnimationClipInstance),goo.FrozenClipSource=function(){function t(t,e){this._source=t,this._time=e}return t.prototype.getSourceData=function(){return this._source.getSourceData()},t.prototype.resetClips=function(){this._source.resetClips(0)},t.prototype.setTime=function(){return this._source.setTime(this._time),!0},t.prototype.isActive=function(){return!0},t.prototype.setTimeScale=function(){},t.prototype.clone=function(){var e=new t(this._source.clone(),this._time);return e},t}(),goo.AbstractAnimationChannel=function(){function t(t,e,n){this._blendType=n||"Linear",this._channelName=t,this._times=(e instanceof Array||e instanceof Float32Array)&&e.length?new Float32Array(e):[],this._lastStartFrame=0}return t.prototype.getSampleCount=function(){return this._times.length},t.prototype.getMaxTime=function(){return this._times.length?this._times[this._times.length-1]:0},t.prototype.updateSample=function(t,e){var n=this._times.length;if(n){var o=n-1;if(0>t||1===n)this.setCurrentSample(0,0,e);else if(t>=this._times[o])this.setCurrentSample(o,0,e);else{var i=0;if(t>=this._times[this._lastStartFrame]){i=this._lastStartFrame;for(var a=this._lastStartFrame;n-1>a&&!(this._times[a]>=t);a++)i=a}else for(var a=0;a<this._lastStartFrame&&!(this._times[a]>=t);a++)i=a;var r=(t-this._times[i])/(this._times[i+1]-this._times[i]);this.setCurrentSample(i,r,e),this._lastStartFrame=i}}},t}(),goo.TransformChannel=function(t,e,n){function o(e,n,o,i,a,r){if(t.call(this,e,n,r),o.length/4!==n.length||i.length/3!==n.length||a.length/3!==n.length)throw new Error("All provided arrays must be the same length (accounting for type)! Channel: "+e);this._rotations=new Float32Array(o),this._translations=new Float32Array(i),this._scales=new Float32Array(a)}var i=new n,a=new n;return o.prototype=Object.create(t.prototype),o.prototype.createStateDataObject=function(){return new e},o.prototype.setCurrentSample=function(t,e,o){var r=o,s=4*t,l=3*t,c=4*(t+1),p=3*(t+1);return 0===e?(r._rotation.data[0]=this._rotations[s+0],r._rotation.data[1]=this._rotations[s+1],r._rotation.data[2]=this._rotations[s+2],r._rotation.data[3]=this._rotations[s+3],r._translation.data[0]=this._translations[l+0],r._translation.data[1]=this._translations[l+1],r._translation.data[2]=this._translations[l+2],r._scale.data[0]=this._scales[l+0],r._scale.data[1]=this._scales[l+1],r._scale.data[2]=this._scales[l+2],void 0):1===e?(r._rotation.data[0]=this._rotations[c+0],r._rotation.data[1]=this._rotations[c+1],r._rotation.data[2]=this._rotations[c+2],r._rotation.data[3]=this._rotations[c+3],r._translation.data[0]=this._translations[p+0],r._translation.data[1]=this._translations[p+1],r._translation.data[2]=this._translations[p+2],r._scale.data[0]=this._scales[p+0],r._scale.data[1]=this._scales[p+1],r._scale.data[2]=this._scales[p+2],void 0):(r._rotation.data[0]=this._rotations[s+0],r._rotation.data[1]=this._rotations[s+1],r._rotation.data[2]=this._rotations[s+2],r._rotation.data[3]=this._rotations[s+3],i.data[0]=this._rotations[c+0],i.data[1]=this._rotations[c+1],i.data[2]=this._rotations[c+2],i.data[3]=this._rotations[c+3],r._rotation.equals(i)||(n.slerp(r._rotation,i,e,a),r._rotation.setVector(a)),r._translation.data[0]=(1-e)*this._translations[l+0]+e*this._translations[p+0],r._translation.data[1]=(1-e)*this._translations[l+1]+e*this._translations[p+1],r._translation.data[2]=(1-e)*this._translations[l+2]+e*this._translations[p+2],r._scale.data[0]=(1-e)*this._scales[l+0]+e*this._scales[p+0],r._scale.data[1]=(1-e)*this._scales[l+1]+e*this._scales[p+1],r._scale.data[2]=(1-e)*this._scales[l+2]+e*this._scales[p+2],void 0)},o.prototype.getData=function(t,n){var o=n?n:new e;return this.setCurrentSample(t,0,o),o},o}(goo.AbstractAnimationChannel,goo.TransformData,goo.Quaternion),goo.JointData=function(t){function e(e){t.call(this,e),this._jointIndex=e?e._jointIndex:0}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.set=function(e){t.prototype.set.call(this,e),this._jointIndex=e._jointIndex},e.prototype.blend=function(n,o,i){var a=i;return a?a instanceof e&&(a._jointIndex=this._jointIndex):(a=new e,a._jointIndex=this._jointIndex),t.prototype.blend.call(this,n,o,a)},e.prototype.clone=function(){return new e(this)},e}(goo.TransformData),goo.JointChannel=function(t,e){function n(e,n,o,i,a,r,s){t.call(this,n,o,i,a,r,s),this._jointName=n,this._jointIndex=e}return n.prototype=Object.create(t.prototype),n.JOINT_CHANNEL_NAME="_jnt",n.prototype.createStateDataObject=function(){return new e},n.prototype.setCurrentSample=function(e,n,o){t.prototype.setCurrentSample.call(this,e,n,o),o._jointIndex=this._jointIndex},n.prototype.getData=function(n,o){var i=o?o:new e;return t.prototype.getData.call(this,n,i),i._jointIndex=this._jointIndex,i},n}(goo.TransformChannel,goo.JointData),goo.ManagedTransformSource=function(t,e,n,o,i,a){function r(t){this._sourceName=t?t:null,this._data={}}return r.prototype.setTranslation=function(t,e){var n=this._data[t];n instanceof o&&n._translation.setVector(e)},r.prototype.getTranslation=function(t,e){var n=this._data[t];return n instanceof o&&(e=e||new i,e.setVector(n._translation)),e},r.prototype.setScale=function(t,e){var n=this._data[t];n instanceof o&&n._scale.setVector(e)},r.prototype.getScale=function(t,e){var n=this._data[t];return n instanceof o&&(e=e||new i,e.setVector(n._scale)),e},r.prototype.setRotation=function(t,e){var n=this._data[t];n instanceof o&&n._rotation.set(e)},r.prototype.getRotation=function(t,e){var n=this._data[t];return n instanceof o&&(e=e||new a,e.setVector(n._rotation)),e},r.prototype.initFromClip=function(t,e,n){if("Include"===e&&n&&n.length)for(var o=0,i=n.length;i>o;o++){var a=n[o],r=t.findChannelByName(a);if(r){var s=r.getData(0);this._data[a]=s}else console.error("Channel not in clip: "+a)}else for(var o=0,i=t._channels.length;i>o;o++){var r=t._channels[o],a=r._channelName;if("Exclude"===e&&n&&n.length&&n.indexOf(a)>-1){var s=r.getData(0);this._data[a]=s}}},r.prototype.resetClips=function(){},r.prototype.setTimeScale=function(){},r.prototype.setTime=function(){return!0},r.prototype.isActive=function(){return!0},r.prototype.getChannelData=function(t){return this._data[t]},r.prototype.getSourceData=function(){return this._data},r.prototype.clone=function(){var t={};for(var e in this._data)t[e]=this._data[e].clone();return new r(this._sourceName,t)},r}(goo.JointChannel,goo.JointData,goo.JointChannel,goo.JointData,goo.Vector3,goo.Quaternion),goo.AnimationClip=function(){function t(t,e){this._name=t,this._channels=e||[],this._maxTime=-1,this.updateMaxTimeIndex()}return t.prototype.update=function(t,e){for(var n=0,o=this._channels.length;o>n;++n){var i=this._channels[n],a=e.getApplyTo(i);i.updateSample(t,a)}},t.prototype.addChannel=function(t){this._channels.push(t),this.updateMaxTimeIndex()},t.prototype.removeChannel=function(t){var e=this._channels.indexOf(t);return e>=0?(this._channels.splice(e,1),this.updateMaxTimeIndex(),!0):!1},t.prototype.findChannelByName=function(t){for(var e=0,n=this._channels.length;n>e;++e){var o=this._channels[e];if(t===o._channelName)return o}return null},t.prototype.updateMaxTimeIndex=function(){this._maxTime=-1;for(var t,e=0;e<this._channels.length;e++){var n=this._channels[e];t=n.getMaxTime(),t>this._maxTime&&(this._maxTime=t)}},t.prototype.toString=function(){return this._name+": "+this._channels.map(function(t){return t._channelName})},t}(),goo.InterpolatedFloatChannel=function(t,e){function n(e,n,o,i){t.call(this,e,n,i),this._values=o?o.slice(0):null}return n.prototype=Object.create(t.prototype),n.prototype.createStateDataObject=function(){return[0]},n.prototype.setCurrentSample=function(t,n,o){o[0]=e.lerp(n,this._values[t],this._values[t+1])},n.prototype.getData=function(t,e){var n=e||[];return n[0]=this._values[t],n},n}(goo.AbstractAnimationChannel,goo.MathUtils),goo.TriggerData=function(){function t(){this._currentTriggers=[],this._currentIndex=-1,this.armed=!1}return t.prototype.arm=function(t,e){if(null===e||0===e.length)this._currentTriggers.length=0,this.armed=!1;else if(t!==this._currentIndex){this._currentTriggers.length=0;for(var n=0,o=e.length;o>n;n++)e[n]&&""!==e[n]&&this._currentTriggers.push(e[n]);this.armed=!0}this._currentIndex=t},t}(),goo.TriggerChannel=function(t,e){function n(e,n,o,i){t.call(this,e,n,i),this._keys=o?o.slice(0):null,this.guarantee=!1}return n.prototype=Object.create(t.prototype),n.prototype.createStateDataObject=function(){return new e},n.prototype.setCurrentSample=function(t,e,n){var o=n._currentIndex,i=1!==e?t:t+1;if(o!==i&&this.guarantee){var a=[];if(o>i){for(var r=o+1;r<this._keys.length;r++)a.push(this._keys[r]);o=-1}for(var r=o+1;i>=r;r++)a.push(this._keys[r]);n.arm(i,a)}else n.arm(i,[this._keys[i]])},n}(goo.AbstractAnimationChannel,goo.TriggerData),goo.AbstractState=function(){function t(){this._globalStartTime=0,this.onFinished=null}return t.prototype.update=function(){},t.prototype.postUpdate=function(){},t.prototype.getCurrentSourceData=function(){},t.prototype.resetClips=function(t){this._globalStartTime=t},t.prototype.shiftClipTime=function(t){this._globalStartTime+=t},t}(),goo.AbstractTransitionState=function(t,e,n){function o(){t.call(this),this._sourceState=null,this._targetState=null,this._percent=0,this._sourceData=null,this._fadeTime=0,this._blendType="Linear"}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype.update=function(t){var e=t-this._globalStartTime;if(e>this._fadeTime&&this.onFinished)return void this.onFinished();var o=e/this._fadeTime;switch(this._blendType){case"SCurve3":this._percent=n.scurve3(o);break;case"SCurve5":this._percent=n.scurve5(o);break;default:this._percent=o}},o.prototype.readFromConfig=function(t){t&&(void 0!==t.fadeTime&&(this._fadeTime=t.fadeTime),void 0!==t.blendType&&(this._blendType=t.blendType))},o.prototype.getCurrentSourceData=function(){var t=this._sourceState?this._sourceState.getCurrentSourceData():null,n=this._targetState?this._targetState.getCurrentSourceData():null;return this._sourceData||(this._sourceData={}),e.combineSourceData(t,n,this._percent,this._sourceData)},o.prototype.isValid=function(t,e){var n=e-this._sourceState._globalStartTime,o=t[0],i=t[1];return 0>=o?0>=i?!0:i>=n:0>=i?n>=o:i>=o?n>=o&&i>=n:n>=o||i>=n},o.prototype.resetClips=function(e){t.prototype.resetClips.call(this,e),this._percent=0},o.prototype.shiftClipTime=function(e){t.prototype.shiftClipTime.call(this,e)},o.prototype.setTimeScale=function(t){this._sourceState&&this._sourceState.setTimeScale(t),this._targetState&&this._targetState.setTimeScale(t)},o}(goo.AbstractState,goo.BinaryLERPSource,goo.MathUtils),goo.FadeTransitionState=function(t){function e(){t.call(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.update=function(e){t.prototype.update.call(this,e),this._sourceState&&this._sourceState.update(e),this._targetState&&this._targetState.update(e)},e.prototype.postUpdate=function(){this._sourceState&&this._sourceState.postUpdate(),this._targetState&&this._targetState.postUpdate()},e.prototype.resetClips=function(e){t.prototype.resetClips.call(this,e),this._targetState&&this._targetState.resetClips(e)},e.prototype.shiftClipTime=function(e){t.prototype.shiftClipTime.call(this,e),this._targetState&&this._targetState.shiftClipTime(e),this._sourceState&&this._sourceState.shiftClipTime(e)},e}(goo.AbstractTransitionState),goo.SyncFadeTransitionState=function(t){function e(){t.call(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.resetClips=function(e){t.prototype.resetClips.call(this,e),this._targetState.resetClips(this._sourceState._globalStartTime)},e.prototype.shiftClipTime=function(e){t.prototype.shiftClipTime.call(this,e),this._targetState.shiftClipTime(this._sourceState._globalStartTime+e),this._sourceState.shiftClipTime(e)},e}(goo.FadeTransitionState),goo.FrozenTransitionState=function(t){function e(){t.call(this)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.update=function(e){t.prototype.update.call(this,e),this._targetState&&this._targetState.update(e)},e.prototype.postUpdate=function(){this._targetState&&this._targetState.postUpdate()},e.prototype.resetClips=function(e){t.prototype.resetClips.call(this,e),this._targetState.resetClips(e)},e.prototype.shiftClipTime=function(e){t.prototype.shiftClipTime.call(this,e),this._targetState.shiftClipTime(e)},e}(goo.AbstractTransitionState),goo.SteadyState=function(t){function e(e){t.call(this),this.id=null,this._name=e,this._transitions={},this._sourceTree=null}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.setClipSource=function(t){this._sourceTree=t},e.prototype.update=function(t){this._sourceTree.setTime(t)||this.onFinished&&this.onFinished()},e.prototype.getCurrentSourceData=function(){return this._sourceTree.getSourceData()},e.prototype.resetClips=function(e){t.prototype.resetClips.call(this,e),this._sourceTree.resetClips(e)},e.prototype.shiftClipTime=function(e){t.prototype.shiftClipTime.call(this,e),this._sourceTree.shiftClipTime(e)},e.prototype.setTimeScale=function(t){this._sourceTree.setTimeScale(t)},e.prototype.clone=function(){var t=new e(this._name);for(var n in this._transitions)t._transitions[n]=this._transitions[n];return t._sourceTree=this._sourceTree.clone(),t},e}(goo.AbstractState),goo.LayerLERPBlender=function(t){function e(){this._blendWeight=null,this._layerA=null,this._layerB=null}return e.prototype.getBlendedSourceData=function(){var e=this._layerA.getCurrentSourceData(),n=this._layerB._currentState?this._layerB._currentState.getCurrentSourceData():null;return t.combineSourceData(e,n,this._blendWeight)},e}(goo.BinaryLERPSource),goo.AnimationLayer=function(t,e,n,o,i,a,r){function s(t,e){this.id=e,this._name=t,this._steadyStates={},this._currentState=null,this._layerBlender=new i,this._transitions={},this._transitionStates={}}return s.BASE_LAYER_NAME="-BASE_LAYER-",s.prototype.getStates=function(){return Object.keys(this._steadyStates)},s.prototype.setState=function(t,e){this._steadyStates[t]=e},s.prototype.setBlendWeight=function(t){this._layerBlender&&(this._layerBlender._blendWeight=r.clamp(t,0,1))},s.prototype.getTransitions=function(){var t;if(t=this._currentState?Object.keys(this._currentState._transitions):[],this._transitions)for(var e in this._transitions)-1===t.indexOf(e)&&t.push(e);return t.sort(),t},s.prototype.update=function(t){this._currentState&&this._currentState.update("undefined"!=typeof t?t:a.time)},s.prototype.postUpdate=function(){this._currentState&&this._currentState.postUpdate()},s.prototype.transitionTo=function(t,e,n){e="undefined"!=typeof e?e:a.time;var i,r=this._currentState;if(this._steadyStates[t]===r)return!1;if(!this._steadyStates[t])return!1;if(r&&r._transitions&&(i=r._transitions[t]||r._transitions["*"]),!i&&this._transitions&&(i=this._transitions[t]||this._transitions["*"]),r instanceof o&&i){var s=this._getTransitionByType(i.type);return this._doTransition(s,r,this._steadyStates[t],i,e,n),!0}if(!r&&(i=this._transitions[t])){var s=this._getTransitionByType(i.type);if(s)return this._doTransition(s,null,this._steadyStates[t],i,e,n),!0}return!1},s.prototype._doTransition=function(t,e,n,o,i,a){if(e){t._sourceState=e;var r=o.timeWindow||[-1,-1];if(!t.isValid(r,i))return void console.warn("State not in allowed time window");e.onFinished=null}t._targetState=n,t.readFromConfig(o),this.setCurrentState(t,!0,i,a)},s.prototype.setCurrentState=function(t,e,n,i){n="undefined"!=typeof n?n:a.time,this._currentState=t,t&&(e&&t.resetClips(n),t.onFinished=function(){this.setCurrentState(t._targetState||null,!1,void 0,i),t instanceof o&&i instanceof Function&&i(),this.update()}.bind(this))},s.prototype.getCurrentState=function(){return this._currentState},s.prototype.setCurrentStateById=function(t,e,n,o){var i=this.getStateById(t);this.setCurrentState(i,e,n,o)},s.prototype.getStateById=function(t){return this._steadyStates[t]},s.prototype.getStateByName=function(t){for(var e in this._steadyStates){var n=this._steadyStates[e];if(n._name===t)return this._steadyStates[e]}},s.prototype.setCurrentStateByName=function(t,e,n){if(t){var o=this.getStateByName(t);if(o)return this.setCurrentState(o,e,n),!0;console.warn("unable to find SteadyState named: "+t)}return!1},s.prototype.getCurrentSourceData=function(){return this._layerBlender?this._layerBlender.getBlendedSourceData():this._currentState?this._currentState.getCurrentSourceData():null},s.prototype.updateLayerBlending=function(t){this._layerBlender&&(this._layerBlender._layerA=t,this._layerBlender._layerB=this)},s.prototype.clearCurrentState=function(){this.setCurrentState(null)},s.prototype.resetClips=function(t){this._currentState&&this._currentState.resetClips("undefined"!=typeof t?t:a.time)},s.prototype.shiftClipTime=function(t){this._currentState&&this._currentState.shiftClipTime("undefined"!=typeof t?t:0)},s.prototype.setTimeScale=function(t){this._currentState&&this._currentState.setTimeScale(t)},s.prototype._getTransitionByType=function(o){if(this._transitionStates[o])return this._transitionStates[o];var i;switch(o){case"Fade":i=new t;break;case"SyncFade":i=new e;break;case"Frozen":i=new n;break;default:console.log("Defaulting to frozen transition type"),i=new n}return this._transitionStates[o]=i},s.prototype.clone=function(){var t=new s(this._name);for(var e in this._steadyStates)t._steadyStates[e]=this._steadyStates[e].clone(),this._steadyStates[e]===this._currentState&&(t._currentState=t._steadyStates[e]);for(var e in this._transitions)t._transitions[e]=this._transitions[e];for(var e in this._transitionStates)t._transitionStates[e]=new this._transitionStates[e].constructor;return t},s}(goo.FadeTransitionState,goo.SyncFadeTransitionState,goo.FrozenTransitionState,goo.SteadyState,goo.LayerLERPBlender,goo.World,goo.MathUtils),goo.AnimationRegister=function(t){for(var e=["goo/scripts/Scripts","goo/animationpack/Joint","goo/animationpack/Skeleton","goo/animationpack/SkeletonPose","goo/animationpack/blendtree/BinaryLERPSource","goo/animationpack/blendtree/ClipSource","goo/animationpack/blendtree/FrozenClipSource","goo/animationpack/blendtree/ManagedTransformSource","goo/animationpack/clip/AbstractAnimationChannel","goo/animationpack/clip/AnimationClip","goo/animationpack/clip/AnimationClipInstance","goo/animationpack/clip/InterpolatedFloatChannel","goo/animationpack/clip/JointChannel","goo/animationpack/clip/JointData","goo/animationpack/clip/TransformChannel","goo/animationpack/clip/TransformData","goo/animationpack/clip/TriggerChannel","goo/animationpack/clip/TriggerData","goo/animationpack/layer/AnimationLayer","goo/animationpack/layer/LayerLERPBlender","goo/animationpack/state/AbstractState","goo/animationpack/state/AbstractTransitionState","goo/animationpack/state/FadeTransitionState","goo/animationpack/state/FrozenTransitionState","goo/animationpack/state/SteadyState","goo/animationpack/state/SyncFadeTransitionState"],n=1;n<e.length;n++){var o=e[n].slice(e[n].lastIndexOf("/")+1);t.addClass(o,arguments[n])}}(goo.Scripts,goo.Joint,goo.Skeleton,goo.SkeletonPose,goo.BinaryLERPSource,goo.ClipSource,goo.FrozenClipSource,goo.ManagedTransformSource,goo.AbstractAnimationChannel,goo.AnimationClip,goo.AnimationClipInstance,goo.InterpolatedFloatChannel,goo.JointChannel,goo.JointData,goo.TransformChannel,goo.TransformData,goo.TriggerChannel,goo.TriggerData,goo.AnimationLayer,goo.LayerLERPBlender,goo.AbstractState,goo.AbstractTransitionState,goo.FadeTransitionState,goo.FrozenTransitionState,goo.SteadyState,goo.SyncFadeTransitionState),goo.AnimationComponent=function(t,e,n,o,i,a){function r(e){t.apply(this,arguments),this.type="AnimationComponent",this.layers=[],this.floats={},this._updateRate=1/60,this._lastUpdate=0,this._triggerCallbacks={};var o=new n(n.BASE_LAYER_NAME);this.layers.push(o),this._skeletonPose=e,this.paused=!1,this.lastTimeOfPause=-1}return r.type="AnimationComponent",r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.transitionTo=function(t,e,n){return this.layers[0].transitionTo(t,void 0,n)?!0:e?this.layers[0].setCurrentStateById(t,!0,void 0,n):!1},r.prototype.getStates=function(){return this.layers[0].getStates()},r.prototype.getCurrentState=function(){return this.layers[0].getCurrentState()},r.prototype.getTransitions=function(){return this.layers[0].getTransitions()},r.prototype.update=function(t){if(!this.paused){if(t="undefined"!=typeof t?t:e.time,0!==this._updateRate){if(t>this._lastUpdate&&t-this._lastUpdate<this._updateRate)return;this._lastUpdate=t-(t-this._lastUpdate)%this._updateRate}for(var n=0,o=this.layers.length;o>n;n++)this.layers[n].update(t)}},r.prototype.apply=function(t){var e=this.getCurrentSourceData(),n=this._skeletonPose;if(e){for(var r=Object.keys(e),s=0,l=r.length;l>s;s++){var c=r[s],p=e[c];if(p instanceof o)n&&p._jointIndex>=0&&p.applyTo(n._localTransforms[p._jointIndex]);else if(p instanceof i)t&&(p.applyTo(t.transform),t.updateTransform(),this._updateWorldTransform(t));else if(p instanceof a){if(p.armed){for(var s=0,h=p._currentTriggers.length;h>s;s++){var u=this._triggerCallbacks[p._currentTriggers[s]];if(u&&u.length)for(var _=0,f=u.length;f>_;_++)u[_]()}p.armed=!1}}else p instanceof Array&&(this.floats[c]=p[0])}n&&n.updateTransforms()}},r.prototype._updateWorldTransform=function(t){t.updateWorldTransform();for(var e=0;e<t.children.length;e++)this._updateWorldTransform(t.children[e])},r.prototype.postUpdate=function(){for(var t=0,e=this.layers.length;e>t;t++)this.layers[t].postUpdate()},r.prototype.getCurrentSourceData=function(){if(0===this.layers.length)return[];var t=this.layers.length-1;this.layers[0]._layerBlender=null;for(var e=0;t>e;e++)this.layers[e+1].updateLayerBlending(this.layers[e]);return this.layers[t].getCurrentSourceData()},r.prototype.addLayer=function(t,e){isNaN(e)?this.layers.push(t):this.layers.splice(e,0,t)},r.prototype.resetClips=function(t){for(var e=0;e<this.layers.length;e++)this.layers[e].resetClips(t)},r.prototype.shiftClipTime=function(t){for(var e=0;e<this.layers.length;e++)this.layers[e].shiftClipTime(t)},r.prototype.setTimeScale=function(t){for(var e=0;e<this.layers.length;e++)this.layers[e].setTimeScale(t)},r.prototype.pause=function(){this.paused||(this.lastTimeOfPause=e.time,this.paused=!0)},r.prototype.stop=function(){this._skeletonPose&&this._skeletonPose.setToBindPose(),this.paused=!0,this.lastTimeOfPause=-1},r.prototype.resume=function(){(this.paused||-1===this.lastTimeOfPause)&&(-1===this.lastTimeOfPause?this.resetClips(e.time):this.shiftClipTime(e.time-this.lastTimeOfPause)),this.paused=!1},r.prototype.clone=function(){var t=new r;return t.layers=this.layers.map(function(t){return t.clone()}),t},r}(goo.Component,goo.World,goo.AnimationLayer,goo.JointData,goo.TransformData,goo.TriggerData),goo.AnimationClipHandler=function(t,e,n,o,i,a,r,s){function l(){t.apply(this,arguments)}return l.prototype=Object.create(t.prototype),l.prototype.constructor=l,t._registerClass("clip",l),l.prototype._create=function(){return new e},l.prototype._update=function(e,n,o){var i=this;return t.prototype._update.call(this,e,n,o).then(function(t){return t?i.loadObject(n.binaryRef,o).then(function(e){if(!e)throw new Error("Binary clip data was empty");return i._updateAnimationClip(n,e,t)}):t})},l.prototype._updateAnimationClip=function(t,e,r){if(r._channels=[],t.channels)for(var l=Object.keys(t.channels),c=0;c<l.length;c++){var p,h=t.channels[l[c]],u=s.getTypedArray(e,h.times),_=h.blendType,f=h.type;switch(f){case"Joint":case"Transform":var d,y,m;d=s.getTypedArray(e,h.rotationSamples),y=s.getTypedArray(e,h.translationSamples),m=s.getTypedArray(e,h.scaleSamples),p="Joint"===f?new n(h.jointIndex,h.name,u,d,y,m,_):new o(h.name,u,d,y,m,_);break;case"FloatLERP":p=new i(h.name,u,h.values,_);break;case"Trigger":p=new a(h.name,u,h.keys),p.guarantee=!!h.guarantee;break;default:console.warn("Unhandled channel type: "+h.type);continue}r.addChannel(p)}return r},l}(goo.ConfigHandler,goo.AnimationClip,goo.JointChannel,goo.TransformChannel,goo.InterpolatedFloatChannel,goo.TriggerChannel,goo.PromiseUtil,goo.ArrayUtil),goo.AnimationComponentHandler=function(t,e,n){function o(){t.apply(this,arguments),this._type="AnimationComponent"}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,t._registerClass("animation",o),o.prototype._create=function(){return new e},o.prototype.update=function(e,o,i){var a=this;return t.prototype.update.call(this,e,o,i).then(function(t){if(t){var e,r=[],s=o.poseRef;s&&(e=a._load(s,i).then(function(e){t._skeletonPose=e}),r.push(e));var l=o.layersRef;return l&&(e=a._load(l,i).then(function(e){t.layers=e,t._layersId=l}),r.push(e)),n.all(r).then(function(){return t})}})},o}(goo.ComponentHandler,goo.AnimationComponent,goo.rsvp),goo.AnimationLayersHandler=function(t,e,n,o,i,a,r,s,l){function c(){t.apply(this,arguments)}return c.prototype=Object.create(t.prototype),c.prototype.constructor=c,t._registerClass("animation",c),c.prototype._create=function(t){var e=[];return this._objects.set(t,e),e
},c.prototype._setInitialState=function(t,e){if(e){var n=t.getStateById(e);t._currentState!==n&&t.setCurrentStateById(e,!0)}else t.setCurrentState()},c.prototype._update=function(e,n,o){var i=this;return t.prototype._update.call(this,e,n,o).then(function(t){if(t){var e=[],a=0;return l.forEach(n.layers,function(n){e.push(i._parseLayer(n,t[a++],o))},null,"sortValue"),r.all(e).then(function(e){t.length=e.length;for(var n=0;n<e.length;n++)t[n]=e[n];return t})}})},c.prototype._parseLayer=function(t,n,o){var i=this;n?n._name=t.name:n=new e(t.name),n.id=t.id,n._transitions=l.deepClone(t.transitions),n._layerBlender&&(n._layerBlender._blendWeight=void 0!==t.blendWeight?t.blendWeight:1);var a=[];return l.forEach(t.states,function(t){a.push(i.loadObject(t.stateRef,o).then(function(t){n.setState(t.id,t)}))},null,"sortValue"),r.all(a).then(function(){return i._setInitialState(n,t.initialStateRef),n})},c}(goo.ConfigHandler,goo.AnimationLayer,goo.LayerLERPBlender,goo.FadeTransitionState,goo.SyncFadeTransitionState,goo.FrozenTransitionState,goo.rsvp,goo.PromiseUtil,goo.ObjectUtil),goo.AnimationStateHandler=function(t,e,n,o,i,a,r,s,l){function c(){t.apply(this,arguments)}return c.prototype=Object.create(t.prototype),c.prototype.constructor=c,t._registerClass("animstate",c),c.prototype._create=function(t){var n=new e;return this._objects.set(t,n),n},c.prototype._update=function(e,n,o){var i=this;return t.prototype._update.call(this,e,n,o).then(function(t){return t?(t._name=n.name,t.id=n.id,t._transitions=l.deepClone(n.transitions),i._parseClipSource(n.clipSource,t._sourceTree,o).then(function(e){return t._sourceTree=e,t})):void 0})},c.prototype._parseClipSource=function(t,e,l){switch(t.type){case"Clip":return this.loadObject(t.clipRef,l).then(function(o){!e||!e instanceof n?e=new n(o,t.filter,t.channels):(e._clip=o,e.setFilter(t.filter,t.channels)),void 0!==t.loopCount&&(e._clipInstance._loopCount=+t.loopCount),void 0!==t.timeScale&&(e._clipInstance._timeScale=t.timeScale),e._startTime=t.startTime||0;for(var i=1/0,a=0;a<o._channels.length;a++)for(var r=o._channels[a],s=0;s<r._times.length;s++){var l=r._times[s];i>l&&(i=l)}return e._startTime=Math.max(e._startTime,i),e});case"Managed":return(!e||!e instanceof o)&&(e=new o),t.clipRef?this.loadObject(t.clipRef,l).then(function(n){return e.initFromClip(n,t.filter,t.channels),e}):s.resolve(e);case"Lerp":var c=[this._parseClipSource(t.clipSourceA,null,l),this._parseClipSource(t.clipSourceB,null,l)];return r.all(c).then(function(n){return e=new i(n[0],n[1]),t.blendWeight&&(e.blendWeight=t.blendWeight),e});case"Frozen":return this._parseClipSource(t.clipSource).then(function(n){return e&&e instanceof a?(e._source=n,e._time=t.frozenTime||0):e=new a(n,t.frozenTime||0),e});default:return console.error("Unable to parse clip source"),s.resolve()}},c}(goo.ConfigHandler,goo.SteadyState,goo.ClipSource,goo.ManagedTransformSource,goo.BinaryLERPSource,goo.FrozenClipSource,goo.rsvp,goo.PromiseUtil,goo.ObjectUtil),goo.SkeletonHandler=function(t,e,n,o,i,a){function r(){t.apply(this,arguments)}return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,t._registerClass("skeleton",r),r.prototype._update=function(t,r){if(!this._objects.has(t)){if(!r)return i.resolve();var s=[];a.forEach(r.joints,function(t){var n=new e(t.name);n._index=t.index,n._parentIndex=t.parentIndex,n._inverseBindPose.matrix.data.set(t.inverseBindPose),s.push(n)},null,"index");var l=new n(r.name,s),c=new o(l);c.setToBindPose(),this._objects.set(t,c)}return i.resolve(this._objects.get(t))},r}(goo.ConfigHandler,goo.Joint,goo.Skeleton,goo.SkeletonPose,goo.PromiseUtil,goo.ObjectUtil),goo.AnimationHandlers=function(){}(goo.AnimationClipHandler,goo.AnimationComponentHandler,goo.AnimationLayersHandler,goo.AnimationStateHandler,goo.SkeletonHandler),goo.AnimationSystem=function(t,e){function n(){t.call(this,"AnimationSystem",["AnimationComponent"])}return n.prototype=Object.create(t.prototype),n.prototype.process=function(){for(var t=0;t<this._activeEntities.length;t++){var n=this._activeEntities[t],o=n.animationComponent;o.update(e.time),o.apply(n.transformComponent),o.postUpdate()}},n.prototype.pause=function(){this.passive=!0;for(var t=0;t<this._activeEntities.length;t++)this._activeEntities[t].animationComponent.pause()},n.prototype.stop=function(){this.passive=!0;for(var t=0;t<this._activeEntities.length;t++){var e=this._activeEntities[t];e.animationComponent.stop()}},n.prototype.resume=function(){this.passive=!1;for(var t=0;t<this._activeEntities.length;t++){var e=this._activeEntities[t];e.animationComponent.resume()}},n}(goo.System,goo.World);
(function (define) {
define("goo/animationpack/Joint", [], function () { return goo.Joint; });
define("goo/animationpack/Skeleton", [], function () { return goo.Skeleton; });
define("goo/animationpack/SkeletonPose", [], function () { return goo.SkeletonPose; });
define("goo/animationpack/clip/TransformData", [], function () { return goo.TransformData; });
define("goo/animationpack/blendtree/BinaryLERPSource", [], function () { return goo.BinaryLERPSource; });
define("goo/animationpack/clip/AnimationClipInstance", [], function () { return goo.AnimationClipInstance; });
define("goo/animationpack/blendtree/ClipSource", [], function () { return goo.ClipSource; });
define("goo/animationpack/blendtree/FrozenClipSource", [], function () { return goo.FrozenClipSource; });
define("goo/animationpack/clip/AbstractAnimationChannel", [], function () { return goo.AbstractAnimationChannel; });
define("goo/animationpack/clip/TransformChannel", [], function () { return goo.TransformChannel; });
define("goo/animationpack/clip/JointData", [], function () { return goo.JointData; });
define("goo/animationpack/clip/JointChannel", [], function () { return goo.JointChannel; });
define("goo/animationpack/blendtree/ManagedTransformSource", [], function () { return goo.ManagedTransformSource; });
define("goo/animationpack/clip/AnimationClip", [], function () { return goo.AnimationClip; });
define("goo/animationpack/clip/InterpolatedFloatChannel", [], function () { return goo.InterpolatedFloatChannel; });
define("goo/animationpack/clip/TriggerData", [], function () { return goo.TriggerData; });
define("goo/animationpack/clip/TriggerChannel", [], function () { return goo.TriggerChannel; });
define("goo/animationpack/state/AbstractState", [], function () { return goo.AbstractState; });
define("goo/animationpack/state/AbstractTransitionState", [], function () { return goo.AbstractTransitionState; });
define("goo/animationpack/state/FadeTransitionState", [], function () { return goo.FadeTransitionState; });
define("goo/animationpack/state/SyncFadeTransitionState", [], function () { return goo.SyncFadeTransitionState; });
define("goo/animationpack/state/FrozenTransitionState", [], function () { return goo.FrozenTransitionState; });
define("goo/animationpack/state/SteadyState", [], function () { return goo.SteadyState; });
define("goo/animationpack/layer/LayerLERPBlender", [], function () { return goo.LayerLERPBlender; });
define("goo/animationpack/layer/AnimationLayer", [], function () { return goo.AnimationLayer; });
define("goo/animationpack/AnimationRegister", [], function () { return goo.AnimationRegister; });
define("goo/animationpack/components/AnimationComponent", [], function () { return goo.AnimationComponent; });
define("goo/animationpack/handlers/AnimationClipHandler", [], function () { return goo.AnimationClipHandler; });
define("goo/animationpack/handlers/AnimationComponentHandler", [], function () { return goo.AnimationComponentHandler; });
define("goo/animationpack/handlers/AnimationLayersHandler", [], function () { return goo.AnimationLayersHandler; });
define("goo/animationpack/handlers/AnimationStateHandler", [], function () { return goo.AnimationStateHandler; });
define("goo/animationpack/handlers/SkeletonHandler", [], function () { return goo.SkeletonHandler; });
define("goo/animationpack/handlers/AnimationHandlers", [], function () { return goo.AnimationHandlers; });
define("goo/animationpack/systems/AnimationSystem", [], function () { return goo.AnimationSystem; });
})(goo.useOwnRequire || !window.define ? goo.define : define);
} (goo.useOwnRequire || !window.define ? goo.require : require)(["goo"], f); })();